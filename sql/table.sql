DROP DATABASE IF EXISTS banque;

CREATE DATABASE banque CHARACTER SET utf8mb4;

USE banque;
CREATE TABLE fonds (
    id INT PRIMARY KEY AUTO_INCREMENT,
    montant DECIMAL(12, 2) NOT NULL,
    date_ajout DATETIME DEFAULT CURRENT_TIMESTAMP,
    description TEXT
);

CREATE TABLE type_pret (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nom VARCHAR(50) NOT NULL ,
    taux DECIMAL(5, 2) NOT NULL ,
    duree_annee INT NULL,
    assurance DECIMAL(5,2)
);

CREATE TABLE client (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nom VARCHAR(50) NOT NULL,
    prenom VARCHAR(50) NOT NULL,
    telephone VARCHAR(20),
    email VARCHAR(100)
);

CREATE TABLE pret (
    id INT PRIMARY KEY AUTO_INCREMENT,
    client_id INT NOT NULL,
    type_pret_id INT NOT NULL,
    montant DECIMAL(12, 2) NOT NULL,
    date_debut DATE NOT NULL,
    est_actif BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (client_id) REFERENCES client(id),
    FOREIGN KEY (type_pret_id) REFERENCES type_pret(id)
);

CREATE TABLE remboursement (
    id INT PRIMARY KEY AUTO_INCREMENT,
    pret_id INT NOT NULL,
    montant DECIMAL(10, 2) NOT NULL,
    date_remboursement DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (pret_id) REFERENCES pret(id)
);

CREATE TABLE mensualite(
    id INT PRIMARY KEY AUTO_INCREMENT,
    pret_id INT,
    mois INT,
    annee INT,
    interet DECIMAL(10,2),
    pret DECIMAL(10,2),
    amortissement DECIMAL(10, 2),
    mensualite DECIMAL(10,2),
    valeur_net DECIMAL(10,2),
    FOREIGN KEY (pret_id) REFERENCES pret(id)
);

INSERT INTO fonds (montant, description) VALUES
(1000000.00, 'Fonds de départ de l''établissement');

INSERT INTO type_pret (nom, taux, duree_annee, assurance) VALUES
('Prêt automobile', 7.50, 3, 1.00),
('Prêt immobilier', 4.50, 10, 0.50);

INSERT INTO client (nom, prenom, telephone, email) VALUES
('Rasoa', 'Marie', '+261330000001', 'rasoa.marie@example.com'),
('Randria', 'Paul', '+261340000002', 'randria.paul@example.com');


INSERT INTO pret (client_id, type_pret_id, montant, date_debut, est_actif) VALUES
(1, 2, 5000000.00, '2024-01-01', TRUE); 

INSERT INTO remboursement (pret_id, montant, date_remboursement) VALUES
(1, 155093.75, '2024-01-10'),
(1, 155093.75, '2024-02-10'),
(1, 155093.75, '2024-04-10'),
(1, 155093.75, '2024-05-10'),
(1, 155093.75, '2024-07-10'), 
(1, 155093.75, '2024-08-10');

INSERT INTO Mensualite (pret_id, mois, annee, interet, pret, amortissement, mensualite, valeur_net) VALUES
(1, 1, 2024, 31250.00, 5000000.00, 123843.75, 155093.75, 4876156.25),
(1, 2, 2024, 30475.98, 4876156.25, 124617.77, 155093.75, 4751538.48),
(1, 3, 2024, 29697.12, 4751538.48, 125396.63, 155093.75, 4626141.85),
(1, 4, 2024, 28913.39, 4626141.85, 126180.36, 155093.75, 4499961.49),
(1, 5, 2024, 28124.76, 4499961.49, 126968.99, 155093.75, 4372992.50),
(1, 6, 2024, 27331.20, 4372992.50, 127762.55, 155093.75, 4245229.95),
(1, 7, 2024, 26532.69, 4245229.95, 128561.06, 155093.75, 4116668.89),
(1, 8, 2024, 25729.18, 4116668.89, 129364.57, 155093.75, 3987304.32),
(1, 9, 2024, 24920.65, 3987304.32, 130173.10, 155093.75, 3857131.22),
(1, 10, 2024, 24107.07, 3857131.22, 130986.68, 155093.75, 3726144.54),
(1, 11, 2024, 23288.40, 3726144.54, 131805.35, 155093.75, 3594339.19),
(1, 12, 2024, 22464.62, 3594339.19, 132629.13, 155093.75, 3461710.06),
(1, 1, 2025, 21635.69, 3461710.06, 133458.06, 155093.75, 3328252.00),
(1, 2, 2025, 20801.58, 3328252.00, 134292.17, 155093.75, 3193959.83),
(1, 3, 2025, 19962.25, 3193959.83, 135131.50, 155093.75, 3058828.33),
(1, 4, 2025, 19117.68, 3058828.33, 135976.07, 155093.75, 2922852.26),
(1, 5, 2025, 18267.83, 2922852.26, 136825.92, 155093.75, 2786026.34),
(1, 6, 2025, 17412.66, 2786026.34, 137681.09, 155093.75, 2648345.25),
(1, 7, 2025, 16552.16, 2648345.25, 138541.59, 155093.75, 2509803.66),
(1, 8, 2025, 15686.27, 2509803.66, 139407.48, 155093.75, 2370396.18),
(1, 9, 2025, 14814.98, 2370396.18, 140278.77, 155093.75, 2230117.41),
(1, 10, 2025, 13938.23, 2230117.41, 141155.52, 155093.75, 2088961.89),
(1, 11, 2025, 13056.01, 2088961.89, 142037.74, 155093.75, 1946924.15),
(1, 12, 2025, 12168.28, 1946924.15, 142925.47, 155093.75, 1803998.68),
(1, 1, 2026, 11274.99, 1803998.68, 143818.76, 155093.75, 1660179.92),
(1, 2, 2026, 10376.12, 1660179.92, 144717.63, 155093.75, 1515462.29),
(1, 3, 2026, 9471.64, 1515462.29, 145622.11, 155093.75, 1369840.18),
(1, 4, 2026, 8561.50, 1369840.18, 146532.25, 155093.75, 1223307.93),
(1, 5, 2026, 7645.67, 1223307.93, 147448.08, 155093.75, 1075859.85),
(1, 6, 2026, 6724.12, 1075859.85, 148369.63, 155093.75, 927490.22),
(1, 7, 2026, 5796.81, 927490.22, 149296.94, 155093.75, 778193.28),
(1, 8, 2026, 4863.71, 778193.28, 150230.04, 155093.75, 627963.24),
(1, 9, 2026, 3924.77, 627963.24, 151168.98, 155093.75, 476794.26),
(1, 10, 2026, 2979.96, 476794.26, 152113.79, 155093.75, 324680.47),
(1, 11, 2026, 2029.25, 324680.47, 153064.50, 155093.75, 171615.97),
(1, 12, 2026, 1072.60, 171615.97, 154021.15, 155093.75, 17594.82),
(1, 1, 2027, 109.97, 17594.82, 17594.82, 17704.79, 0.00);

